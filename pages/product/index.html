<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Produto</title>
    <link rel="stylesheet" href="../../global.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&display=swap');
        
        body {
            background-color: white;
            font-family: 'Bangers', sans-serif;
            margin: 0;
            padding: 0;
            color: white;
            overflow-x: hidden;
        }
        .product-container {
            display: flex;
            max-width: 1200px;
            height: 69%;
            margin: 1rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .product-image {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: transparent;
            border-radius: 15px;
            padding: 1rem;
            transform: skew(-5deg);
        }
        .product-image img {
            max-width: 100%;
            max-height: 600px;
            object-fit: contain;
            transform: rotate(10deg);
        }
        .product-details {
            flex: 1;
            padding: 0 2rem;
        }
        .product-title {
            font-size: 3rem;
            color: black;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }
        .product-price {
            font-size: 2rem;
            color: rgb(255, 73, 60);
            margin-bottom: 1rem;
        }
        .product-description {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: black;
        }
        .product-specs {
            background-color: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid rgb(255, 73, 60);
        }
        .product-specs ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        .product-specs li {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: black;
        }
        .add-to-cart {
            background-color: rgb(60, 102, 255);
            color: white;
            border: 3px solid rgb(60, 102, 255);
            padding: 1rem 2rem;
            margin-top: 1rem;
            font-size: 1.8rem;
            font-family: 'Bangers', sans-serif;
            cursor: pointer;
            transform: skew(-10deg);
            transition: all 0.3s ease;
        }
        .add-to-cart:hover {
            background-color: rgb(60, 102, 255);
            transform: skew(-10deg) scale(1.05);
        }
    </style>
</head>
<body>
    <nav>
        <a href="/">
            <img src="../../assets/hotwheels.png" alt="Logo">
        </a>
        <div class="nav-items">
            <div class="nav-links">
                <a href="/pages/catalogo/index.html">Cat√°logo</a>
                <a href=""></a>
                <a href=""></a>
            </div>
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 19.7823C18 18.2488 17.3679 16.778 16.2426 15.6936C15.1174 14.6092 13.5913 14 12 14C10.4087 14 8.88258 14.6092 7.75736 15.6936C6.63214 16.778 6 18.2488 6 19.7823" fill="white"/>
                <path d="M18 19.7823C18 18.2488 17.3679 16.778 16.2426 15.6936C15.1174 14.6092 13.5913 14 12 14C10.4087 14 8.88258 14.6092 7.75736 15.6936C6.63214 16.778 6 18.2488 6 19.7823C10.5545 22.7752 13.1886 22.703 18 19.7823Z" fill="white"/>
                <path d="M18 19.7823C18 18.2488 17.3679 16.778 16.2426 15.6936C15.1174 14.6092 13.5913 14 12 14C10.4087 14 8.88258 14.6092 7.75736 15.6936C6.63214 16.778 6 18.2488 6 19.7823"  stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18 19.7823C18 18.2488 17.3679 16.778 16.2426 15.6936C15.1174 14.6092 13.5913 14 12 14C10.4087 14 8.88258 14.6092 7.75736 15.6936C6.63214 16.778 6 18.2488 6 19.7823C10.5545 22.7752 13.1886 22.703 18 19.7823Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 14C14.2091 14 16 12.2091 16 10C16 7.79086 14.2091 6 12 6C9.79086 6 8 7.79086 8 10C8 12.2091 9.79086 14 12 14Z" stroke="white" stroke-width="0" stroke-linecap="round" fill="white" stroke-linejoin="round"/>
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                
                
        </div>
    </nav>
    <div class="fix-height"></div>
    <div class="product-container">
        <div class="product-image">
            <img id="img" src="../../assets/velozefurioso.png" alt="">
        </div>
        <div class="product-details">
            <h1 class="product-title"></h1>
            <div class="product-price"></div>
            <div class="product-description">
            </div>
            <div class="product-specs">
                <ul id="specs">
                </ul>
            </div>
            <button class="add-to-cart">ADICIONAR AO CARRINHO!</button>
        </div>
    </div>
    <script type="module">
        import { addCar, getCars, remCar } from '../admin/admin.js';


        async function getDominantColor(imageUrl) {
         try {
                // Fetch the image URL and convert it to a Blob
                const response = await fetch(imageUrl);
                if (!response.ok) {
                    throw new Error('Failed to fetch image');
                }
            
                const blob = await response.blob();
            
                // Create an Image object from the Blob
                const img = new Image();
                img.src = URL.createObjectURL(blob);
            
                return new Promise((resolve, reject) => {
                    img.onload = function() {
                        // Draw the image on the canvas
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                    
                        // Get image data from the canvas
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const pixels = imageData.data;
                    
                        // Track color counts
                        const colorCounts = {};
                        let maxCount = 0;
                        let dominantColor = '';
                    
                        for (let i = 0; i < pixels.length; i += 4) {
                            const red = pixels[i];
                            const green = pixels[i + 1];
                            const blue = pixels[i + 2];
                            const alpha = pixels[i + 3];
                        
                            // Only consider fully opaque pixels and ignore almost white or very dark pixels
                            if (alpha === 255) {
                                // Ignore pixels that are nearly white (e.g., very light colors)
                                if (red > 240 && green > 240 && blue > 240) {
                                    continue;
                                }
                                // Ignore very dark pixels (e.g., very close to black)
                                if (red < 30 && green < 30 && blue < 30) {
                                    continue;
                                }
                            
                                const color = `${red},${green},${blue}`;
                            
                                if (colorCounts[color]) {
                                    colorCounts[color]++;
                                } else {
                                    colorCounts[color] = 1;
                                }
                            
                                if (colorCounts[color] > maxCount) {
                                    maxCount = colorCounts[color];
                                    dominantColor = color;
                                }
                            }
                        }
                    
                        if (dominantColor) {
                            resolve(dominantColor);
                        } else {
                            resolve(null);
                        }
                    };
                
                    img.onerror = function() {
                        reject(new Error('Failed to load image'));
                    };
                });
            } catch (error) {
                throw error;
            }
        }



        async function getProduct() {
            const cars = getCars()


            const product = cars[localStorage.getItem('productClicked')]
            document.title = product.name
            document.querySelector('.product-title').textContent = product.name
            document.querySelector('.product-description').innerHTML = product.description
            document.querySelector('.product-price').innerHTML = 'R$ ' + product.pricePerDay
            document.getElementById('img').alt = product.name
            document.querySelector('#specs').innerHTML = `<li>${product.description}</li>`
            document.querySelector('.product-image').style.backgroundColor = `rgb(${await getDominantColor(document.getElementById('img').src)})`

        }
       getProduct()

      

    </script>
</body>
</html>